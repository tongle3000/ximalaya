##  yarn add react-native-snap-carousel

##  yarn add @types/react-native-snap-carousel -D
    pages -> Home -> Carousel.tsx

        /**
        * 轮播图 组件
        */
        import { hp, viewportWidth, wp } from '@/utils';
        import React from 'react';
        import { StyleSheet } from 'react-native';
        import { Image } from 'react-native';
        import SnapCarousel, { AdditionalParallaxProps } from 'react-native-snap-carousel';

        // 图片
        // const images = require('../../assets/carousel/001.jpg');
        const images = [
            'https://file07.16sucai.com/2019/1112/775824cf3615639b7bd67beec87ca5aa.jpg',
            'https://file07.16sucai.com/2020/0713/bf5ee490cb0872cf5b58230b56c0c9c0.jpg',
            'https://file06.16sucai.com/2016/0120/a6ad792c4f0bf314b49627d1606a3abf.jpg',
            'https://file06.16sucai.com/2016/0120/869c21d28f6012ecca97911271459787.jpg',
        ];

        // 轮播图的宽度:
        const sliderWidth = viewportWidth;

        const sideWidth = wp(94); // 图片宽度
        const sideHeight = hp(26); // 图片高度

        const itemWidth = wp(94) + wp(3) * 2; // 滚动的整个 item宽度= 图片宽度 + 2 边边距

        class Carousel extends React.Component {
            renderItem = ({item}: {item: string}/* , parallaxProps?:AdditionalParallaxProps */) => {
                return <Image source ={{uri: item}} style={styles.image} />;
                
            };
            render() {
                return (
                    <SnapCarousel
                        data={images}
                        renderItem={this.renderItem}
                        sliderWidth={sliderWidth}
                        itemWidth={itemWidth}
                    />
                );
            }
        };

        const styles = StyleSheet.create({
            image: {
                width: sideWidth,
                height: sideHeight,
                marginLeft: "auto",
                marginRight: "auto"

            }
        })

        export default Carousel;



##  Utils -> index.ts 写一些工具类的, 帮我们计算轮播图 宽度、高度.

        import { Dimensions } from 'react-native';

        const { width: viewportWidth, height: viewportHeight } = Dimensions.get(
            'window',
        );

        // 根据百分比获取宽度的函数
        function wp(percentage: number) {
            const value = (percentage * viewportWidth) / 100;
            return Math.round(value); // 四舍五入;
        }

        function hp(percentage: number) {
            const value = (percentage * viewportHeight) / 100;
            return Math.round(value); // 四舍五入;
        }

        export { viewportWidth, viewportHeight, wp, hp };


##  引入轮播图组件
    pages -> Home -> index.tsx
    引入 Carousel.tsx 组件
    

##  轮播图 改进( 增加显示圆点)
        /**
        * 轮播图
        */
        import { hp, viewportWidth, wp } from '@/utils';
        import React from 'react';
        import { StyleSheet, View } from 'react-native';
        import { Image } from 'react-native';
        import SnapCarousel, { AdditionalParallaxProps, Pagination, ParallaxImage } from 'react-native-snap-carousel';

        // 图片
        // const images = require('../../assets/carousel/001.jpg');
        const data = [
            'https://file07.16sucai.com/2019/1112/775824cf3615639b7bd67beec87ca5aa.jpg',
            'https://file07.16sucai.com/2020/0713/bf5ee490cb0872cf5b58230b56c0c9c0.jpg',
            'https://file06.16sucai.com/2016/0120/a6ad792c4f0bf314b49627d1606a3abf.jpg',
            'https://file06.16sucai.com/2016/0120/869c21d28f6012ecca97911271459787.jpg',
        ];

        // 轮播图的宽度:
        const sliderWidth = viewportWidth;

        const sideWidth = wp(94); // 图片宽度
        const sideHeight = hp(26); // 图片高度

        const itemWidth = wp(94) + wp(3) * 2; // 滚动的整个 item宽度= 图片宽度 + 2 边边距

        class Carousel extends React.Component {
            // ④步: 显示的圆点
            state = {
                activeSlide: 0,
            };
            // ③步: 显示的圆点
            onSnapToItem = (index: number) => {
                this.setState({
                    activeSlide: index,
                });
            };

            renderItem = (
                { item }: { item: string },
                parallaxProps?: AdditionalParallaxProps /*视差图片 ParallaxImage */,
            ) => {
                // return <Image source ={{uri: item}} style={styles.image} />; // Image 是从 react-native 导入的
                // 视差图片 ParallaxImage(上面改为下面这句)
                return (
                    <ParallaxImage
                        source={{ uri: item }}
                        style={styles.image}
                        containerStyle={styles.imageContainer}
                        parallaxFactor={0.8} // 视差速度默认 0.3,
                        showSpinner // 加载动画的效果
                        spinnerColor="rgba(0, 0, 0, .25)" // 加载中的颜色
                        {...parallaxProps}
                    />
                );
            };

            // 小圆点状态
            get pagaination() {
                // ⑥步: 显示的圆点
                const { activeSlide } = this.state;

                return (
                    <View style={styles.paginationWrapper}>
                        <Pagination
                            activeDotIndex={activeSlide} // ①显示的圆点: 当前显示的哪张图的圆点.
                            dotsLength={data.length} // 圆点个数
                            containerStyle={styles.paginationContainer}
                            dotContainerStyle={styles.dotContainer}
                            dotStyle={styles.dot}
                            inactiveDotScale={0.7} // 不是当前的显示圆点 大小的比例放大一点点
                            inactiveDotOpacity={0.4} // 不是当前的显示圆点 透明度
                        />
                    </View>
                );
            }

            render() {
                return (
                    <>
                        <SnapCarousel
                            data={data}
                            renderItem={this.renderItem}
                            sliderWidth={sliderWidth}
                            itemWidth={itemWidth}
                            // 视差图片 ParallaxImage
                            hasParallaxImages={true} // ={true}可以省略不写.
                            onSnapToItem={this.onSnapToItem} // ②显示的圆点
                            loop
                            autoplay
                        />
                        {/* // ⑦步: 显示的圆点 */}
                        {this.pagaination}
                    </>
                );
            }
        }

        const styles = StyleSheet.create({
            // 视差图片 ParallaxImage
            imageContainer: {
                width: sideWidth,
                height: sideHeight,
                marginLeft: 'auto',
                marginRight: 'auto',
                borderRadius: 8,
            },
            // 包圆点的块,跟图片一样大的区域
            paginationWrapper: {
                position:"relative",
                justifyContent:'center',
                alignItems:'center'
            },
            // 圆点块的区域
            paginationContainer: {
                position: "absolute",
                bottom:10,
                backgroundColor:'rgba(0,0,0, .35)',
                paddingHorizontal: 3,  // 水平内边距
                paddingVertical: 4,    // 垂直内边距
                borderRadius: 8, // 设置个圆角.
            },
            // 圆点样式
            dotContainer: {
                marginHorizontal: 6, // 外边距 margin 改为 6 ;
            },
            dot: {
                width:6,
                height: 6,
                borderRadius:3,
                backgroundColor:'rgba(255,255,255, .92)'
            },
            image: {
                ...StyleSheet.absoluteFillObject, // 绝对定位
                resizeMode: 'cover', // 伸缩模式
            },
        });

        export default Carousel;


##  轮播图 动态获取数据

  # 1、用 YApi 新建数据 
    获取 后台数据,,通过 DVA 管理.

    1. Yapi (相关问题.md 有详细的 YAPI 文档)
    电脑终端: 启动服务 brew services start mongodb-community

    2. cd bear-yapi (进入到 Yapi 安装路径:)  (这里安装的路径: /Users/tongle3000/bear-yapi, 所以直接 cd bear-yapi就可以了)
    3. node vendors/server/app.js ( 显示服务已启动, 我们浏览器打开那个网址 登录进去.)

    进入"喜马拉雅"项目, 添加一个分类 "首页模块"

    添加接口:
    接口名称: 轮播图接口
    接口路径: /carousel
                  提交
    编辑 -> "返回数据设置, root右边点'+'" 
    设置: status, number,100,     备注, 点右边 + 添加兄弟节点
    设置: msg,    string, success,备注, 点右边 + 添加兄弟节点
    填项: data,   array                 (下面自动增加,我们选 object 类型 就是大括号)
                 object                  点右边 + 添加子节点
         id,     string, @id
         image,  string, @image('400x150')
         colors, array
                 string, @color
    点保存
         


        {
            "status": 100,
            "msg": "success",
            "data": [
                {
                    "id": "0",
                    "image": "图片地址",
                    "color": ["#eee", "#ddd"]
                }
            ]
        }
  * 数据地址: http://127.0.0.1:3001/mock/11/bear/carousel



  # 2 、引用 YApi 新建好的数据.

  - 安装: yarn add axios
    做些配置:

  - http.ts
    src -> config -> 新建文件: http.ts

        import axios from 'axios';

        axios.defaults.baseURL='http://127.0.0.1:3001'; // 配置 IP 端口

        // 添加 请求拦截器
        axios.interceptors.request.use( function(config) {
            console.log('请求 config', config)
            return config;
        }, function(error) {      // use 的第二个参数, 错误的回调函数.
            return Promise.reject(error);
        });

        // 添加 响应拦截器
        axios.interceptors.response.use( function(response) {
            console.log('响应数据 response', response)
            return response.data;
        }, function(error) {      // use 的第二个参数, 错误的回调函数.
            return Promise.reject(error);
        })


  - .env 文件 应该是环境配置文件
        API_URL=https://myapi.com 
        改为 本地地址: 
        API_URL=http://127.0.0.1:3001
    
  - http.ts 文件修改:
    导入: import Config  from 'react-native-config';
    
    axios.defaults.baseURL='http://127.0.0.1:3001'; 
    改为: 
    axios.defaults.baseURL=Config.API_URL; // 配置 IP 端口

    这样以后要改 API,只要改 .env 文件就可以了
  - src -> index.tsx 
    只需要 import 导入 http.ts 就可以了 
    import '@/config/http';         // http.ts 只需要 import 进来就可以了
    代码:
        import '@/config/http';
        import store from '@/config/dva';
        import Navigator from '@/navigator';
        import React from 'react';
        import { StatusBar } from 'react-native';
        import { Provider } from 'react-redux';

        export default class extends React.Component {
            // 这里是省略 calss 名字写法,也是可以的.
            render() {
                return (
                    // Provider 这个的作业, 让它里面包裹的组件,都能得到 store = {store} 的值
                    <Provider store={store}>
                        <Navigator />
                        <StatusBar
                            backgroundColor="transparent" // 背景色透明
                            barStyle="dark-content" // 深色
                            translucent // 半透明
                        />
                    </Provider>
                );
            }
        }

  - models -> home.ts
        import axios from 'axios';
        import { Effect, Model } from 'dva-core-ts';
        import { Reducer } from 'redux';

        const CAROUSEL_URL = '/mock/11/bear/carousel'; // ② 加入动态数据 yapi; 数据的接口的 后面部分的 地址.

        // ④ 加入动态数据 yapi;   13 步 增加export 供 Home -> Carousel.tsx 使用.
        export interface ICarousel {
            id: string;
            image: string;
            colors: [string, string];
        }

        // Reducer
        interface HomeState {
            carousels: ICarousel[]; // ③ 加入动态数据 yapi; 第四步,定义这个的类型 包括哪些属性.
        }

        // 声明接口
        interface HomeModel extends Model {
            namespace: 'home'; // namespace: string;
            
            state: HomeState; // ③ 加入动态数据 yapi;
            
            // reducers?: ReducersMapObject | ReducersMapObjectWithEnhancer;
            reducers: {
                // add: Reducer<HomeState>; // 到上面声明个 
                setState: Reducer<HomeState>; // ⑤ 加入动态数据 yapi;  add 改成 setState
            };
            
            // effects?: EffectsMapObject;
            effects: {
                // 里面定义一个 action
                // asyncAdd: Effect; 
                fetchCarousels: Effect;     // ⑥ 加入动态数据 yapi; 
            };
            
            // subscriptions?: SubscriptionsMapObject;
        }

        // 下面 state 报 "HomeState | undefined"
        // 这里可以把 state 提出去,顶一个初始的 state
        const initialState = {
            // num: 0,
            carousels: [], // ⑦ 加入动态数据 yapi;  轮播图初始值, 我们给个空的数组.
            loading: false, // 添加个加载状态, 默认是 false, 所以可以注释掉.
        }

        // 延迟函数, 模拟异步的.
        // function delay(timeout: number) {
        // 	return new Promise(resolve => {
        // 		setTimeout(resolve, timeout);
        // 	})
        // }

        const homeModel: HomeModel = { // 报"在此处声明了 "effects" 错误, 先把上面effects 注释了, effects是异步,先做同步的.
            namespace: 'home',
            state: initialState,
            reducers: {  // 万能 reducer
                setState(state = initialState, { payload /* ,type */ }) {  // ⑦ 加入动态数据 yapi; add 我们已经改成了 setState
                    // dva 已经帮我们处理了 action, 可以通过结构的方法直接取到; 如果需要 type 可以写上

                    // payload 会返回一个对象
                    return {
                        ...state, // 旧的 state
                        
                        // ⑧ 加入动态数据 yapi;   下面这个这个加就不用了, 注释掉; ...payload 加进来
                        // num: state.num + payload.num, // 新的属性; 以前的 + 新的payload.num
                        ...payload,

                        // state 报 "HomeState | undefined", 可以把 state 提出去,顶一个初始的 state, 上面个 state 一个默认值 state=initialState
                                                
                    }
                },
            },
            effects: {
                
                // *asyncAdd({payload}, {call, put}) { // action 改 {payload}
                // 	yield call(delay, 3000); // 调用上面的方法, 第 2 个参数 3000
                // 	yield put({ // put 接收 action
                // 		type: 'add',
                // 		payload, // 这个不做处理,直接传进来
                // 	});
                // }
                // 上面的改为: 
                // ⑨ 加入动态数据 yapi; fetchCarousels: 请求轮播图的一个异步请求  的 action. 
                // 还需要个 action 触发这个请求.pages -> Home -> index.tsx 文件 的 Home 组件里
                *fetchCarousels(_, {call, put}) { // "_" 占位置的入参
                    // 改成: ajax 请求
                    const { data/*, state, msg */ } = yield call(axios.get, CAROUSEL_URL); // get, 请求地址,
                    console.log('轮播图数据: ', data);
                    yield put({
                        type: 'setState',
                        payload: {
                            carousels: data,
                        }
                    })
                }
            },
        };

        export default homeModel;
  - pages -> Home -> Carousel.tsx
        /**
        * 轮播图
        */
        import { ICarousel } from '@/models/home';
        import { hp, viewportWidth, wp } from '@/utils';
        import React from 'react';
        import { StyleSheet, View } from 'react-native';
        import { Image } from 'react-native';
        import SnapCarousel, { AdditionalParallaxProps, Pagination, ParallaxImage } from 'react-native-snap-carousel';

        // ⑩③ 加入动态数据 yapi; 定义一个接口 IProps, 下面的 data 可以不要了
        interface IProps {
            data: ICarousel[];
        }

        /**
        * // import { Image } from 'react-native';
        * // 如果是用 Image 组件 必须是在react-native 导入; 下面是优化换成了 Carousel 视差组件 视差图片 ParallaxImage
        */

        // 图片
        // const images = require('../../assets/carousel/001.jpg');
        // const data = [
        // 	'https://file07.16sucai.com/2019/1112/775824cf3615639b7bd67beec87ca5aa.jpg',
        // 	'https://file07.16sucai.com/2020/0713/bf5ee490cb0872cf5b58230b56c0c9c0.jpg',
        // 	'https://file06.16sucai.com/2016/0120/a6ad792c4f0bf314b49627d1606a3abf.jpg',
        // 	'https://file06.16sucai.com/2016/0120/869c21d28f6012ecca97911271459787.jpg',
        // ];

        // 轮播图的宽度:
        const sliderWidth = viewportWidth;

        const sideWidth = wp(94); // 图片宽度
        const sideHeight = hp(26); // 图片高度

        const itemWidth = wp(94) + wp(3) * 2; // 滚动的整个 item宽度= 图片宽度 + 2 边边距

        class Carousel extends React.Component<IProps> { // ⑩④ 加入动态数据 yapi; IProps做为泛型,传进来.
            // ④步: 显示的圆点 
            state = {
                activeSlide: 0,
            };
            // ③步: 显示的圆点
            onSnapToItem = (index: number) => { // 这个onSnapToItem 函数,有个参数, index
                this.setState({
                    activeSlide: index,
                });
            };

            // 小圆点状态(组件), 把它当成一个变量,一个属性来使用
            get pagaination() {
                // ⑥步: 显示的圆点 this state 获取某一个图片
                const { activeSlide } = this.state;
                const {data} =this.props; // ⑩⑧ 加入动态数据 yapi; data 从 props 取.
                return (
                    <View style={styles.paginationWrapper}>
                        <Pagination
                            activeDotIndex={activeSlide} // ①显示的圆点: 当前显示的哪张图的圆点.
                            dotsLength={data.length} // 圆点个数
                            inactiveDotScale={0.7} // 不是当前的显示圆点 大小的比例放大一点点
                            inactiveDotOpacity={0.4} // 不是当前的显示圆点 透明度
                            // styles
                            containerStyle={styles.paginationContainer}
                            dotContainerStyle={styles.dotContainer}
                            dotStyle={styles.dot}
                        />
                    </View>
                );
            }

            // 滚动图片 (组件)
            renderItem = (
                { item }: { item: ICarousel },     // ⑩⑥ 加入动态数据 yapi;  item string 类型改为 ICarousel
                parallaxProps?: AdditionalParallaxProps /*视差图片 ParallaxImage */,
            ) => {
                // return <Image source ={{uri: item}} style={styles.image} />; // Image 是从 react-native 导入的
                // 视差图片 ParallaxImage(上面改为下面这句)
                return (
                    <ParallaxImage
                        source={{ uri: item.image }} // ⑩⑦ 加入动态数据 yapi;  item.image; // 如果传的是网络的图片,必须定义他的宽高.

                        style={styles.image}
                        containerStyle={styles.imageContainer}
                        
                        spinnerColor="rgba(0, 0, 0, .25)" // 图片加载中的颜色
                        {...parallaxProps} /*视差图片 ParallaxImage */
                        parallaxFactor={0.8} // 视差图片 速度默认 0.3,
                        showSpinner // 视差图片 加载动画的效果
                    />
                );
            };

            render() {
                const {data} =this.props; // ⑩⑤ 加入动态数据 yapi; data 从 props 取.
                return (
                    <>
                        <SnapCarousel
                            data={data} // 图片数据
                            renderItem={this.renderItem} // 每一次渲染这个图片,它的组件

                            sliderWidth={sliderWidth} // 应该是整个轮播的宽度
                            itemWidth={itemWidth}     // 每张图滚动的宽度
                            // 视差图片 ParallaxImage
                            hasParallaxImages={true} // ={true}可以省略不写, 只有 true APP 里才会显示图片. 视差图片 ParallaxImage
                            onSnapToItem={this.onSnapToItem} // ② 监听当前显示的圆点, 提供给 Pagination 组件的 activeDotIndex={activeSlide} // ①显示的圆点: 当前显示的哪张图的圆点.
                            loop                             // 循环拖动
                            autoplay                         // 自动循环播放
                        />
                        {/* // ⑦步: 显示所有圆点 的 组件 */}
                        {this.pagaination}
                    </>
                );
            }
        }

        const styles = StyleSheet.create({
            // 视差图片 ParallaxImage
            imageContainer: {
                width: sideWidth,
                height: sideHeight,
                marginLeft: 'auto',
                marginRight: 'auto',
                borderRadius: 8,
            },
            // 包圆点的块,跟图片一样大的区域
            paginationWrapper: {
                position:"relative",
                justifyContent:'center',
                alignItems:'center'
            },
            // 圆点块的区域
            paginationContainer: {
                position: "absolute",
                bottom:10,
                backgroundColor:'rgba(0,0,0, .35)',
                paddingHorizontal: 3,  // 水平内边距
                paddingVertical: 4,    // 垂直内边距
                borderRadius: 8, // 设置个圆角.
            },
            // 圆点样式
            dotContainer: {
                marginHorizontal: 6, // 外边距 margin 改为 6 ;
            },
            dot: {
                width:6,
                height: 6,
                borderRadius:3,
                backgroundColor:'rgba(255,255,255, .92)'
            },
            image: {
                ...StyleSheet.absoluteFillObject, // 绝对定位
                resizeMode: 'cover', // 伸缩模式
            },
        });

        export default Carousel;
  - pages -> Home -> index.tsx
        import { RootState } from '@/models';
        import { RootStackNavigation } from '@/navigator';
        import React from 'react';
        import { Button, Text, View } from 'react-native';
        import { connect, ConnectedProps } from 'react-redux';

        import Carousel from './Carousel';

        // dva ; 正在加载..:loading,loading.effects['home/asyncAdd'];
        const mapStateToProps= ({home, loading}: RootState) => ({ //state 改成 对象结构的方法 {home}
            carousels: home.carousels, // ⑩① 加入动态数据 yapi;
            loading: loading.effects['home/asyncAdd'], // 跟异步操作的 type 值是一样的
        });

        // connect 帮我们把 models 里定义的 state 映射到 这个页面来.
        const connector = connect(mapStateToProps);

        type ModelState = ConnectedProps<typeof connector>

        interface IProps extends ModelState {
            navigation: RootStackNavigation;
        };

        // type IProps = {
        //     navigation: RootStackNavigation;
        // };

        class Home extends React.Component<IProps> {

            // ⑩ 加入动态数据 yapi;
            componentDidMount( ) {
                const {dispatch} = this.props;
                dispatch({
                    type: 'home/fetchCarousels', // fetchCarousels 是 models -> home.ts 里定义的 action
                });
            }


            onPress = () => {
                const { navigation } = this.props;
                navigation.navigate('Detail', {
                    id: 200,
                });
            };

            // 加法 运算 方法.
            // handleAdd = ()=> {
            //     const {dispatch} = this.props;
            //     dispatch({
            //         type: 'home/add', // 这里是找到 dva.ts 里的 HomeModel 里的 add() 方法
            //         payload: {        // 第二个参数
            //             num: 10,      // 每次加 10
            //         }
            //     })
            // }

            // // 异步加:   点了之后,会过段时间处理,  中间等的时间长的话,可以提示下用户 "正在加载..."
            // asyncAdd= () => {
            //     const {dispatch} = this.props;
            //     dispatch({
            //         type: 'home/asyncAdd', // 这里是找到 dva.ts 里的 HomeModel 里的 add() 方法
            //         payload: {        // 第二个参数
            //             num: 3,      // 每次加 3
            //         }
            //     })
            // }
            render() {
                const {carousels} = this.props;   // 从 dva home 里取 num
                return (
                    <View style={{ flexDirection:"column", alignItems:"center",}}>
                        {/* // ⑩② 加入动态数据 yapi; 把数据传入下面这个组件里, 再到 Carousel.tsx 里定义一个接口, IProps */}
                        <Carousel data = { carousels } />
                        <Button title="跳转到详情页2" onPress={this.onPress} />
                        
                    </View>
                );
            }
        }

        export default connector(Home);


    