##  猜你喜欢模块
 # 1、用 YApi 新建数据 
    获取 后台数据,,通过 DVA 管理.

    1. brew services start mongodb-community
        Yapi (相关问题.md 有详细的 YAPI 文档)
        电脑终端: 启动服务 brew services start mongodb-community

    2. cd bear-yapi 
        (进入到 Yapi 安装路径:)  (这里安装的路径: /Users/tongle3000/bear-yapi, 所以直接 cd bear-yapi就可以了)
    3. node vendors/server/app.js 
        ( 显示服务已启动, 我们浏览器打开那个网址 登录进去.)

    进入"喜马拉雅"项目, 添加一个分类 "首页模块"

    添加接口:
    接口名称: 猜你喜欢
    接口路径: /guess

    status, number 100, 
    msg,    string success,
    data,   array, 高级设置: 最小元素个数:6 , 最多...: 6;
      items,object , +
        id,    string, @id
        title, string, @ctitle             // ctitle 中文标题.
        image, string, http://39.105.213.120/thumbnail/@integer(1,61).jpg
    保存.
#   models -> home.ts
        带"猜你喜欢" 就是改动过的.

        import axios from 'axios';
        import { Effect, Model } from 'dva-core-ts';
        import { Reducer } from 'redux';


        // 轮播图
        const CAROUSEL_URL = '/mock/11/bear/carousel'; // ② 加入动态数据 yapi; 数据的接口的 后面部分的 地址.

        // ① ② ③ ④ ⑤ ⑥ ⑦ ⑧ ⑨ ⑩
        // ① 猜你喜欢模块
        const Guess_URL = '/mock/11/bear/guess';

        // ② 猜你喜欢模块
        export interface IGuess {
            id: string;
            image: string;
            title: string;
        }

        // ④ 加入动态数据 yapi;   13 步 增加export 供 Home -> Carousel.tsx 使用.
        export interface ICarousel {
            id: string;
            image: string;
            colors: [string, string];
        }

        // Reducer
        interface HomeState {
            carousels: ICarousel[]; // ③ 加入动态数据 yapi; 第四步,定义这个的类型 包括哪些属性.
            guess: IGuess[]; // ③ 猜你喜欢模块
        }

        // 声明接口
        interface HomeModel extends Model {
            namespace: 'home'; // namespace: string;
            
            state: HomeState; // ③ 加入动态数据 yapi;
            
            // reducers?: ReducersMapObject | ReducersMapObjectWithEnhancer;
            reducers: {
                // add: Reducer<HomeState>; // 到上面声明个 
                setState: Reducer<HomeState>; // ⑤ 加入动态数据 yapi;  add 改成 setState
            };
            
            // effects?: EffectsMapObject;
            effects: {
                // 里面定义一个 action
                // asyncAdd: Effect; 
                fetchCarousels: Effect;     // ⑥ 加入动态数据 yapi; 
                fetchGuess: Effect;  // ④ 猜你喜欢模块
            };
            
            // subscriptions?: SubscriptionsMapObject;
        }

        // 下面 state 报 "HomeState | undefined"
        // 这里可以把 state 提出去,顶一个初始的 state
        const initialState = {
            // num: 0,
            carousels: [], // ⑦ 加入动态数据 yapi;  轮播图初始值, 我们给个空的数组.
            loading: false, // 添加个加载状态, 默认是 false, 所以可以注释掉.
            guess: [],// ⑤ 猜你喜欢模块
        }

        // 延迟函数, 模拟异步的.
        // function delay(timeout: number) {
        // 	return new Promise(resolve => {
        // 		setTimeout(resolve, timeout);
        // 	})
        // }

        const homeModel: HomeModel = { // 报"在此处声明了 "effects" 错误, 先把上面effects 注释了, effects是异步,先做同步的.
            namespace: 'home',
            state: initialState,
            reducers: {  // 万能 reducer
                setState(state = initialState, { payload /* ,type */ }) {  // ⑦ 加入动态数据 yapi; add 我们已经改成了 setState
                    // dva 已经帮我们处理了 action, 可以通过结构的方法直接取到; 如果需要 type 可以写上

                    // payload 会返回一个对象
                    return {
                        ...state, // 旧的 state
                        
                        // ⑧ 加入动态数据 yapi;   下面这个这个加就不用了, 注释掉; ...payload 加进来
                        // num: state.num + payload.num, // 新的属性; 以前的 + 新的payload.num
                        ...payload,

                        // state 报 "HomeState | undefined", 可以把 state 提出去,顶一个初始的 state, 上面个 state 一个默认值 state=initialState
                                                
                    }
                },
            },
            effects: {
                
                // *asyncAdd({payload}, {call, put}) { // action 改 {payload}
                // 	yield call(delay, 3000); // 调用上面的方法, 第 2 个参数 3000
                // 	yield put({ // put 接收 action
                // 		type: 'add',
                // 		payload, // 这个不做处理,直接传进来
                // 	});
                // }
                // 上面的改为: 
                // ⑨ 加入动态数据 yapi; fetchCarousels: 请求轮播图的一个异步请求  的 action. 
                // 还需要个 action 触发这个请求.pages -> Home -> index.tsx 文件 的 Home 组件里
                *fetchCarousels(_, {call, put}) { // "_" 占位置的入参
                    // 改成: ajax 请求
                    const { data/*, state, msg */ } = yield call(axios.get, CAROUSEL_URL); // get, 请求地址,
                    console.log('轮播图数据: ', data);
                    yield put({
                        type: 'setState',
                        payload: {
                            carousels: data,
                        }
                    })
                },
                // ⑥ 猜你喜欢模块; 写个生成器的函数;
                *fetchGuess(_, {call, put}) {
                    const {data} = yield call(axios.get, Guess_URL);
                    yield put({
                        type: 'setState',
                        payload: {
                            guess: data,
                        }
                    });
                }
            },
        };

#   pages-> Home -> 新建组件 Guess.tsx 

        import { RootState } from '@/models';
        import React from 'react';
        import { FlatList, StyleSheet, Text, View } from 'react-native';
        import { Image } from 'react-native';
        import { connect, ConnectedProps } from 'react-redux';

        const mapStateToProps = ({ home }: RootState) => {
            return {
                guess: home.guess,
            };
        };
        const connector = connect(mapStateToProps);

        // 要发起个 action, 这个组件加载完后执行 ③ ; 这句是获取 dispatch
        type ModelState = ConnectedProps<typeof connector>;

        class Guess extends React.Component<ModelState> {
            // ModelState 是获取 dispatch
            // 要发起个 action, 这个组件加载完后执行 ①
            componentDidMount() {
                this.fetch();
            }
            // 要发起个 action, 这个组件加载完后执行 ②
            fetch = () => {
                const { dispatch } = this.props; //
                dispatch({
                    // dispatch 作业,发起一个 action
                    type: 'home/fetchGuess', // 对象 action
                });
            };

            // 返回的是个组件, 这里使用 View, 图片必须制定宽高.
            // }
            renderItem = ({ item }: {item:IGuess}) => {
                return (
                    <View style ={styles.item}>
                        <Image source = {{uri: item.image}} style={ styles.image} /> 
                        <Text numberOfLines={2}>{item.title}</Text>
                        {/* numberOfLines={2} 最多显示 2 行. */}
                    </View>
                );
            };

            render() {
                const { guess } = this.props;
                return (
                    <View style={styles.container}>
                        <Text>猜你喜欢data</Text>
                        {/* <Text>{JSON.stringify(guess)}</Text> JSON.stringify(guess) 打印出了 json 代码  */}
                        {/* FlatList 展示数据, 先上面从 react-native 引入这个组件 */}
                        <FlatList 
                            data={guess} 
                            renderItem={this.renderItem} 
                            numColumns={3} // 3 列
                            
                        />
                    </View>
                );
            }
        }

        const styles = StyleSheet.create({
            container: {
                backgroundColor: '#fff',
                borderRadius: 8,
                margin: 16,
            },
            item: {
                flex:1,
                alignItems: 'center',
                marginVertical: 6,   // 外 竖向: 元素 与 元素之间的 边距 8
                marginHorizontal: 10, // 外 横向: 元素 与 元素之间的 边距 5
            },
            image: {
                width: '100%',
                height:100,
                borderRadius: 8,
                marginBottom: 4,
            }
        });
        export default connector(Guess);





#   pages -> Home -> index.tsx
    import Guess from './Guess';
    <Guess  />

#   pages -> Home -> Guess.tsx
    加链接, 之前的 View 组件改成 自定义改进组件 Touchable  (TouchableOpacity  activeOpacity 默认值 小于 {0.8},透明度太低, 按下的 item 颜色太重. 这里值改成 0.8 就透明度高一点,只有一点.)

        import Touchable from '@/components/Touchable';

        <Touchable style ={styles.item} onPress={() => {alert('dian')}}>
            <Image source = {{uri: item.image}} style={ styles.image} /> 
			<Text numberOfLines={2}>{item.title}</Text>
            {/* numberOfLines={2} 最多显示 2 行. */}
		</Touchable>
